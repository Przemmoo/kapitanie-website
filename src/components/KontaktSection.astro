---
// Sekcja Kontakt z formularzem i informacjami
export interface Props {
  data?: {
    title?: string;
    subtitle?: string;
    working_hours?: string;
    response_time?: string;
    contact_methods?: Array<{
      icon: string;
      title: string;
      value: string;
      link?: string;
    }>;
  };
}

const { data } = Astro.props;

// Fallback values jeśli brak danych z CMS
const contactData = {
  title: data?.title || "Porozmawiajmy o Twoim wydarzeniu",
  subtitle: data?.subtitle || "Masz pomysł, planujesz event lub potrzebujesz wyceny? Wypełnij formularz lub zadzwoń. Odpowiadamy w ciągu 24 godzin.",
  working_hours: data?.working_hours || "Poniedziałek - Piątek: 9:00 - 18:00",
  response_time: data?.response_time || "Średni czas odpowiedzi: 2 godziny",
  contact_methods: data?.contact_methods || [
    {
      icon: "phone",
      title: "Telefon",
      value: "+48 501 181 703",
      link: "tel:+48501181703"
    },
    {
      icon: "mail",
      title: "Email",
      value: "kontakt@kapitanie.pl",
      link: "mailto:kontakt@kapitanie.pl"
    },
    {
      icon: "map-pin",
      title: "Adres",
      value: "ul. Różana 54B/1, 32-020 Wieliczka",
      link: "https://maps.google.com/maps?q=ul.+Różana+54B/1,+32-020+Wieliczka"
    }
  ]
};
---

<section id="kontakt" class="section kontakt-section">
  <div class="container">
    <!-- Section Header -->
    <div class="section-header">
      <h2 class="section-title">{contactData.title}</h2>
      <p class="section-subtitle">
        {contactData.subtitle}
      </p>
    </div>

    <div class="kontakt-grid">
      <!-- Lewa strona - Formularz kontaktowy -->
      <div class="contact-form-container">
        <form class="contact-form" id="contact-form" novalidate>
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">Imię *</label>
              <input 
                type="text" 
                id="firstName" 
                name="firstName" 
                required 
                autocomplete="given-name"
                aria-describedby="firstName-error"
              />
              <span class="error-message" id="firstName-error"></span>
            </div>
            
            <div class="form-group">
              <label for="lastName">Nazwisko *</label>
              <input 
                type="text" 
                id="lastName" 
                name="lastName" 
                required 
                autocomplete="family-name"
                aria-describedby="lastName-error"
              />
              <span class="error-message" id="lastName-error"></span>
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              required 
              autocomplete="email"
              aria-describedby="email-error"
            />
            <span class="error-message" id="email-error"></span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="phone">Telefon</label>
              <input 
                type="tel" 
                id="phone" 
                name="phone" 
                autocomplete="tel"
                aria-describedby="phone-error"
              />
              <span class="error-message" id="phone-error"></span>
            </div>
            
            <div class="form-group">
              <label for="company">Firma</label>
              <input 
                type="text" 
                id="company" 
                name="company" 
                autocomplete="organization"
                aria-describedby="company-error"
              />
              <span class="error-message" id="company-error"></span>
            </div>
          </div>

          <div class="form-group">
            <label for="eventType">Rodzaj wydarzenia *</label>
            <select 
              id="eventType" 
              name="eventType" 
              required
              aria-describedby="eventType-error"
            >
              <option value="">Wybierz rodzaj wydarzenia</option>
              <option value="konferencja">Konferencja</option>
              <option value="gala">Gala firmowa</option>
              <option value="koncert">Koncert</option>
              <option value="pokaz-mody">Pokaz mody</option>
              <option value="wesele">Wesele</option>
              <option value="event-korporacyjny">Event korporacyjny</option>
              <option value="targi">Targi / Wystawa</option>
              <option value="inne">Inne</option>
            </select>
            <span class="error-message" id="eventType-error"></span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="eventDate">Planowana data</label>
              <input 
                type="date" 
                id="eventDate" 
                name="eventDate"
                aria-describedby="eventDate-error"
                min=""
              />
              <span class="error-message" id="eventDate-error"></span>
            </div>
            
            <div class="form-group">
              <label for="guestCount">Liczba gości</label>
              <select 
                id="guestCount" 
                name="guestCount"
                aria-describedby="guestCount-error"
              >
                <option value="">Wybierz liczbę gości</option>
                <option value="do-50">Do 50 osób</option>
                <option value="50-100">50-100 osób</option>
                <option value="100-300">100-300 osób</option>
                <option value="300-500">300-500 osób</option>
                <option value="500-1000">500-1000 osób</option>
                <option value="ponad-1000">Ponad 1000 osób</option>
              </select>
              <span class="error-message" id="guestCount-error"></span>
            </div>
          </div>

          <div class="form-group">
            <label for="services">Potrzebne usługi</label>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" name="services" value="oswietlenie" />
                <span class="checkmark"></span>
                Oświetlenie sceniczne
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="services" value="naglosnienie" />
                <span class="checkmark"></span>
                Nagłośnienie
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="services" value="multimedia" />
                <span class="checkmark"></span>
                Multimedia / Ekrany LED
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="services" value="aplikacja" />
                <span class="checkmark"></span>
                Aplikacja eventowa
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="services" value="streaming" />
                <span class="checkmark"></span>
                Transmisja online
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="services" value="kompleksowa" />
                <span class="checkmark"></span>
                Obsługa kompleksowa
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="message">Opisz swoje wydarzenie *</label>
            <textarea 
              id="message" 
              name="message" 
              rows="5" 
              required
              placeholder="Opowiedz nam o swoim wydarzeniu, wizji i oczekiwaniach. Im więcej szczegółów, tym lepszą wycenę będziemy mogli przygotować."
              aria-describedby="message-error"
            ></textarea>
            <span class="error-message" id="message-error"></span>
          </div>

          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" name="privacy" required aria-describedby="privacy-error" />
              <span class="checkmark"></span>
              Akceptuję <a href="/polityka-prywatnosci" target="_blank">politykę prywatności</a> *
            </label>
            <span class="error-message" id="privacy-error"></span>
          </div>

          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" name="newsletter" />
              <span class="checkmark"></span>
              Chcę otrzymywać newsletter z informacjami o nowościach i inspiracjach eventowych
            </label>
          </div>

          <button type="submit" class="btn btn-primary submit-btn">
            <span class="btn-text">Wyślij zapytanie</span>
            <span class="btn-loading">
              <svg class="spinner" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                  <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                  <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
                </circle>
              </svg>
              Wysyłanie...
            </span>
          </button>

          <div class="form-response" id="form-response"></div>
        </form>
      </div>

      <!-- Prawa strona - Informacje kontaktowe -->
      <div class="contact-info">
        <div class="info-card">
          <h3>Skontaktuj się bezpośrednio</h3>
          
          <div class="contact-methods">
            {contactData.contact_methods.map((method) => (
              <div class="contact-method">
                <div class="contact-icon">
                  {method.icon === 'phone' && (
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                  )}
                  {method.icon === 'mail' && (
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                      <polyline points="22,6 12,13 2,6"/>
                    </svg>
                  )}
                  {method.icon === 'map-pin' && (
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                      <circle cx="12" cy="10" r="3"/>
                    </svg>
                  )}
                  {method.icon === 'clock' && (
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12,6 12,12 16,14"/>
                    </svg>
                  )}
                </div>
                <div class="contact-details">
                  <span class="contact-label">{method.title}</span>
                  {method.link ? (
                    <a href={method.link} class="contact-value">{method.value}</a>
                  ) : (
                    <span class="contact-value">{method.value}</span>
                  )}
                </div>
              </div>
            ))}
            
            <!-- Dodatkowe informacje -->
            <div class="contact-method">
              <div class="contact-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12,6 12,12 16,14"/>
                </svg>
              </div>
              <div class="contact-details">
                <span class="contact-label">Godziny pracy</span>
                <span class="contact-value">{contactData.working_hours}</span>
              </div>
            </div>
            
            <div class="contact-method">
              <div class="contact-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="2"/>
                  <path d="M20.2 20.2c2.04-2.03.02-7.36-.61-10.57C19.59 9.63 19.59 6.37 19.59 6.37s-1.17-2.63-7.59-2.63S4.41 6.37 4.41 6.37s0 3.26 0 3.26c-.63 3.21-2.65 8.54-.61 10.57"/>
                </svg>
              </div>
              <div class="contact-details">
                <span class="contact-label">Czas odpowiedzi</span>
                <span class="contact-value">{contactData.response_time}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .kontakt-section {
    background: linear-gradient(135deg, var(--bg-main) 0%, var(--bg-secondary) 100%);
    position: relative;
  }

  .section-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .section-title {
    color: var(--text-main);
    margin-bottom: 1rem;
  }

  .section-subtitle {
    font-size: 1.2rem;
    color: var(--text-secondary);
    max-width: 700px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .kontakt-grid {
    display: grid;
    grid-template-columns: 1.85fr 1fr;
    gap: 2rem;
    align-items: start;
  }

  /* Contact Form */
  .contact-form-container {
    background: var(--bg-secondary);
    border-radius: 20px;
    padding: 3rem;
    border: 1px solid rgba(0, 169, 255, 0.1);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  }

  .contact-form {
    width: 100%;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-main);
    font-weight: 600;
    font-size: 0.9rem;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 12px 16px;
    background: var(--bg-main);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: var(--text-main);
    font-size: 1rem;
    transition: var(--transition-fast);
    font-family: var(--font-body);
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px rgba(0, 169, 255, 0.1);
  }

  .form-group input::placeholder,
  .form-group textarea::placeholder {
    color: var(--text-secondary);
  }

  /* Checkbox styles */
  .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    cursor: pointer;
    font-size: 0.9rem;
    color: var(--text-main);
    transition: var(--transition-fast);
  }

  .checkbox-label:hover {
    color: var(--accent-blue);
  }

  .checkbox-label input[type="checkbox"] {
    display: none;
  }

  .checkmark {
    width: 20px;
    height: 20px;
    background: var(--bg-main);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    position: relative;
    transition: var(--transition-fast);
    flex-shrink: 0;
  }

  .checkbox-label input[type="checkbox"]:checked + .checkmark {
    background: var(--accent-blue);
    border-color: var(--accent-blue);
  }

  .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 2px;
    width: 6px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }

  /* Submit button */
  .submit-btn {
    width: 100%;
    padding: 15px 30px;
    font-size: 1.1rem;
    position: relative;
    overflow: hidden;
  }

  .btn-loading {
    display: none;
    align-items: center;
    gap: 0.5rem;
  }

  .submit-btn.loading .btn-text {
    display: none;
  }

  .submit-btn.loading .btn-loading {
    display: flex;
  }

  .submit-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  .spinner {
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* Error messages */
  .error-message {
    display: block;
    color: var(--error-color);
    font-size: 0.8rem;
    margin-top: 0.3rem;
    min-height: 1rem;
  }

  .form-group.error input,
  .form-group.error select,
  .form-group.error textarea {
    border-color: var(--error-color);
  }

  /* Form response */
  .form-response {
    margin-top: 1rem;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    display: none;
  }

  .form-response.success {
    background: rgba(40, 167, 69, 0.1);
    border: 1px solid rgba(40, 167, 69, 0.3);
    color: #28a745;
  }

  .form-response.error {
    background: rgba(255, 68, 68, 0.1);
    border: 1px solid rgba(255, 68, 68, 0.3);
    color: var(--error-color);
  }

  /* Contact Info */
  .contact-info {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .info-card {
    background: rgba(31, 31, 31, 0.5);
    border-radius: 16px;
    padding: 2rem;
    border: 1px solid rgba(0, 169, 255, 0.1);
    transition: var(--transition-fast);
  }

  .info-card:hover {
    background: rgba(31, 31, 31, 0.8);
    border-color: rgba(0, 169, 255, 0.3);
  }

  .info-card h3 {
    color: var(--text-main);
    margin-bottom: 1.5rem;
    font-size: 1.3rem;
  }

  .contact-methods {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .contact-method {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
  }

  .contact-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--accent-blue), #0088CC);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    flex-shrink: 0;
  }

  .contact-icon svg {
    width: 20px;
    height: 20px;
  }

  .contact-details {
    flex: 1;
  }

  .contact-label {
    display: block;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.3rem;
  }

  .contact-value {
    color: var(--text-main);
    font-weight: 600;
    text-decoration: none;
    transition: var(--transition-fast);
  }

  .contact-value:hover {
    color: var(--accent-blue);
  }

  /* Response time stats */
  .response-time {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .response-stat {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(0, 169, 255, 0.05);
    border-radius: 8px;
  }

  .stat-icon {
    font-size: 1.5rem;
  }

  .stat-number {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--accent-blue);
  }

  .stat-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
  }

  /* Direct contact buttons */
  .direct-contact-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .direct-contact-buttons .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 12px 24px;
  }

  .direct-contact-buttons .btn svg {
    width: 18px;
    height: 18px;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .kontakt-grid {
      gap: 3rem;
    }

    .contact-form-container {
      padding: 2rem;
    }
  }

  @media (max-width: 768px) {
    .kontakt-grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .form-row {
      grid-template-columns: 1fr;
      gap: 0;
    }

    .contact-form-container {
      padding: 1.5rem;
    }

    .info-card {
      padding: 1.5rem;
    }

    .direct-contact-buttons {
      flex-direction: row;
    }
  }

  @media (max-width: 480px) {
    .contact-form-container {
      padding: 1rem;
    }

    .info-card {
      padding: 1rem;
    }

    .direct-contact-buttons {
      flex-direction: column;
    }

    .contact-method {
      flex-direction: column;
      text-align: center;
      gap: 0.5rem;
    }

    .contact-icon {
      width: 36px;
      height: 36px;
      margin: 0 auto;
    }
  }

  /* Date input styling */
  input[type="date"] {
    position: relative;
  }

  input[type="date"]::-webkit-calendar-picker-indicator {
    background: transparent;
    color: var(--accent-blue);
  }

  /* Select styling */
  select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    appearance: none;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form');
    const submitBtn = form.querySelector('.submit-btn');
    const formResponse = document.getElementById('form-response');

    // Set minimum date to today
    const eventDateInput = document.getElementById('eventDate');
    if (eventDateInput) {
      const today = new Date().toISOString().split('T')[0];
      eventDateInput.setAttribute('min', today);
    }

    // Form validation
    const validateField = (field) => {
      const value = field.value.trim();
      const name = field.name;
      const errorElement = document.getElementById(`${name}-error`);
      const formGroup = field.closest('.form-group');
      
      let isValid = true;
      let errorMessage = '';

      // Required field validation
      if (field.required && !value) {
        isValid = false;
        errorMessage = 'To pole jest wymagane';
      }

      // Email validation
      if (name === 'email' && value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
          isValid = false;
          errorMessage = 'Wprowadź poprawny adres email';
        }
      }

      // Phone validation
      if (name === 'phone' && value) {
        const phoneRegex = /^[\+]?[0-9\s\-\(\)]{9,}$/;
        if (!phoneRegex.test(value)) {
          isValid = false;
          errorMessage = 'Wprowadź poprawny numer telefonu';
        }
      }

      // Privacy checkbox validation
      if (name === 'privacy' && field.required && !field.checked) {
        isValid = false;
        errorMessage = 'Akceptacja polityki prywatności jest wymagana';
      }

      // Update UI
      if (errorElement) {
        errorElement.textContent = errorMessage;
      }
      
      if (formGroup) {
        formGroup.classList.toggle('error', !isValid);
      }

      return isValid;
    };

    // Real-time validation
    const formFields = form.querySelectorAll('input, select, textarea');
    formFields.forEach(field => {
      field.addEventListener('blur', () => validateField(field));
      field.addEventListener('input', () => {
        if (field.closest('.form-group').classList.contains('error')) {
          validateField(field);
        }
      });
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validate all fields
      let isFormValid = true;
      formFields.forEach(field => {
        if (!validateField(field)) {
          isFormValid = false;
        }
      });

      if (!isFormValid) {
        formResponse.textContent = 'Proszę poprawić błędy w formularzu';
        formResponse.className = 'form-response error';
        formResponse.style.display = 'block';
        return;
      }

      // Show loading state
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;
      formResponse.style.display = 'none';

      try {
        // Prepare form data
        const formData = new FormData(form);
        const data = {};
        
        // Handle regular fields
        for (let [key, value] of formData.entries()) {
          if (key === 'services') {
            if (!data.services) data.services = [];
            data.services.push(value);
          } else {
            data[key] = value;
          }
        }

        // Simulate API call (replace with actual endpoint)
        await new Promise(resolve => setTimeout(resolve, 2000));

        // Success response
        formResponse.innerHTML = `
          <strong>Dziękujemy za wysłanie zapytania!</strong><br>
          Odpowiemy w ciągu 24 godzin. Sprawdź swoją skrzynkę email.
        `;
        formResponse.className = 'form-response success';
        formResponse.style.display = 'block';

        // Reset form
        form.reset();
        
        // Remove error classes
        document.querySelectorAll('.form-group.error').forEach(group => {
          group.classList.remove('error');
        });

        // Track conversion (analytics)
        if (typeof gtag !== 'undefined') {
          gtag('event', 'form_submit', {
            event_category: 'Contact',
            event_label: 'Contact Form'
          });
        }

      } catch (error) {
        console.error('Form submission error:', error);
        formResponse.innerHTML = `
          <strong>Wystąpił błąd podczas wysyłania.</strong><br>
          Spróbuj ponownie lub skontaktuj się telefonicznie.
        `;
        formResponse.className = 'form-response error';
        formResponse.style.display = 'block';
      } finally {
        // Hide loading state
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
      }
    });

    // Intersection Observer for animations
    const observerOptions = {
      threshold: 0.2,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('fade-in-up');
        }
      });
    }, observerOptions);

    // Observe elements
    document.querySelectorAll('.section-header, .contact-form-container, .info-card').forEach(el => {
      observer.observe(el);
    });

    // Auto-resize textarea
    const messageTextarea = document.getElementById('message');
    if (messageTextarea) {
      messageTextarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
    }

    // Phone number formatting
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
      phoneInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.startsWith('48')) {
          value = '+48 ' + value.substring(2);
        } else if (value.length > 0 && !value.startsWith('+')) {
          value = '+48 ' + value;
        }
        e.target.value = value;
      });
    }
  });
</script>
